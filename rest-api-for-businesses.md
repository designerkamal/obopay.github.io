# Obopay Rest APIs for Businesses

Obopay has exposed the following rest APIs for integration for Businesses. All the APIs should be called following 'Obopay Secure Communication Protocol'. Protocol is covered in a document provided separately and it is also packaged as a Java / node library for ease of use.

## authKey API

This API is used by business to get an Auth key used for initializing Obopay Web Payments SDK. The JSON format of the POST body is given below.

    {
      businessRegistrationId : As provided to business
      userMobileNo           : Country ISD prefix + 10 digit mobile number (Example +919876512345)
    }

API response is as follows.

    {
      error         : null
      data          : {
        authKey       : Key used to initialize payments web SDK
        userStatus    : User registration status
      }
    }

List of User Status:

  - REGISTERED
  - NOT_REGISTERED
  - CARD_NOT_LINKED
  - KYC_SUSPENDED
  - KYC_PENDING


## KYC Document Upload API

API for uploading KYC documents for a user. The JSON format of the POST body is given below.

    {
      businessRegistrationId : As provided to business
      userMobileNo           : Country ISD prefix + 10 digit mobile number (Example +919876512345)
      kycDocuments           : Array of kycDocument, explained below
    }

    kycDocument Object has following fields:
    {
      kycType       : 'MAJOR' | 'MINOR'
      category      : Address proof, id proof etc. CODES described in next section 
      type          : Depending on category, CODES described in next section 
      urls          : Object of urls (front and back) based on type of document. 
                      In case url access is protected, please embed url with 
                      access-token / session id in the url itself. Url should point to resources 
                      that are images. Images should be less than 500 KB in size. 
                      Example : {
                                    front: "https://business.com/access-token/id_name_front.jpeg",
                                    back : "https://business.com/access-token/id_name_back.jpeg"
                                } 
    }

## isCardLinked API

API for checking if a card has been issued to the given mobile number. The JSON format of the POST body is given below.

    {
      mobileNumber  : User's mobile number with Obopay
      last4Digits   : the last four digits of the card
      expiryDate    : the card expiry date in MM/YY format
    }

API response is as follows.

    {
      error         : null
      data          : {
        linked        : true / false
      }
    }

## makePaymentFromSelf API

This Api is used, when a business wishes to transfer money from its own account to end-users account. The JSON format of the POST body is given below.

    {
      mobileNumber      : Beneficiary mobile number as registered with Obopay.
      amount            : the amount to be transferred
      paymentContextId  : A unique context that represents this transfer.
                          Described below.
      message           : Remarks/reason for payment (optional)
    }

API response is as follows.

    {
      error     : null
      data      : {
        paymentContextId  : Id with which request was made
        amount            : Amount transferred (it is always same as requested amount)
        oboTransactionId  : the transaction reference no generated at Obopay
      }
    }

In case of failure the response will be

    {
      error     : null
      data      : {
        errorCode     : error code for the failure,
        errorMessage  : the error description
      }  
    }

List of common errors:

  - Insufficient balance in business account
  - Invalid user mobile number
  - Customer account will go above limit
  - Duplicate payment context id

### Payment Context Id

`PaymentContextId` represents unique context of money transfer across all users. Obopay allows only single payment under a business/merchant with a PaymentContextId. PaymentContextId helps solve duplicate payment problem to/from a user, while providing a context to business systems to query status of a pending payment request.

PaymentContextId is generated by Merchant's server. Here are few examples on how to generate PaymentContextId:

- Salary / incentive payment for a month: concatenation of `yymm` and `userId`
- Refund of some order: concatenation of 'refund' and `orderNo`
- Ad-hoc transfer: Generate a unique id (transfer request id), and disallow transfers till the last transfer is incomplete / timed-out.


## checkPaymentStatus API

Obopay provides a status check API to query the status of a transaction under a paymentContextId. This is needed in case of any communication failure during transferMoneyFromSelf API call.

The JSON format of the POST body is given below.

    {
      paymentContextId : the paymentContextId being queried.
    }

API response is as follows.

    {
      error     : null
      data      : {
        oboTransactionId  : the transaction reference number at Obopay (may be null)
        success           : true / false
      }
    }
