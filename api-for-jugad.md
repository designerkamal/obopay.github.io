# Obopay Rest APIs for Jugad

Obopay has exposed the following rest APIs for integration with Jugad. All the APIs should be called following 'Obopay Secure Communication Protocol'. Protocol is covered in a document provided separately.

Besides these API, Jugad will also have access to a portal, where it will have access to following features:

- Check balance in it's account
- Check last transactions from it's account
- Do bulk transfer to users (can be used to correct any reconciliation or ad-hoc needs)

## isCardLinked API

API for checking if a card has been issued to the given mobile number. The JSON format of the POST body is given below.

    {
      mobileNumber  : User's mobile number with Obopay
      last4Digits   : the last four digits of the card
      expiryDate    : the card expiry date in MM/YY format
    }

API response is as follows.

    {
      error         : null
      data          : {
        linked        : true / false
      }
    }

## makePaymentFromSelf API

This Api is used, when a business wishes to transfer money from its own account to end-users account. The JSON format of the POST body is given below.

    {
      mobileNumber      : Beneficiary mobile number as registered with Obopay.
      amount            : the amount to be transferred
      paymentContextId  : A unique context that represents this transfer.
                          Described below.
      message           : Remarks/reason for payment (optional)
    }
    
API response is as follows.

    {
      error     : null
      data      : { 
        paymentContextId  : Id with which request was made
        amount            : Amount transferred (it is always same as requested amount)
        oboTransactionId  : the transaction reference no generated at Obopay
      } 
    }
    
In case of failure the response will be 
    
    {
      error     : null
      data      : {
        errorCode     : error code for the failure,
        errorMessage  : the error description
      }  
    }

List of common errors:

  - Insufficient balance in business account
  - Invalid user mobile number
  - Customer account will go above limit
  - Duplicate payment context id

### Payment Context Id

`PaymentContextId` represents unique context of money transfer across all users. Obopay allows only single payment under a business/merchant with a PaymentContextId. PaymentContextId helps solve duplicate payment problem to/from a user, while providing a context to business systems to query status of a pending payment request.

PaymentContextId is generated by Merchant's server. Here are few examples on how to generate PaymentContextId:

- Salary / incentive payment for a month: concatenation of `yymm` and `userId`
- Refund of some order: concatenation of 'refund' and `orderNo`
- Ad-hoc transfer: Generate a unique id (transfer request id), and disallow transfers till the last transfer is incomplete / timed-out.


## checkPaymentStatus API

Obopay provides a status check API to query the status of a transaction under a paymentContextId. This is needed in case of any communication failure during transferMoneyFromSelf API call.

The JSON format of the POST body is given below.

    {
      paymentContextId : the paymentContextId being queried.
    }
    
API response is as follows.

    {
      error     : null
      data      : {
        oboTransactionId  : the transaction reference number at Obopay (may be null)
        success           : true / false
      } 
    }


## temporaryCheckBalance API

Temporarily Obopay will provide an Api to check user balance. This API will be automatically withdrawn from 1st Oct 2019. The same support would be provided in Android SDK with display of user balances and transactions.

The JSON format of the POST body is given below.

    {
      mobileNumber      : Beneficiary mobile number as registered with Obopay.
    }
    
API response is as follows.

    {
      error     : null
      data      : {
        balance  : number // in INR
      } 
    }    